(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["gobang"],{"1f34":function(t,e,s){t.exports=s.p+"img/defeat.492f4857.png"},"211b":function(t,e,s){t.exports=s.p+"img/black.95fc5cac.png"},"3ea5":function(t,e,s){"use strict";var o=s("e322"),a=s.n(o);a.a},"9d8c":function(t,e,s){"use strict";s.r(e);var o=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"gobang-box"},[t.roomInfo?[o("p",{staticClass:"title"},[t._v("房间"),o("span",{domProps:{textContent:t._s(t.roomInfo.title)}})]),o("div",{staticClass:"room-info-box"},[o("div",{staticClass:"left-box"},[o("p",{staticClass:"status",domProps:{textContent:t._s(t.roomInfo.statusText)}}),o("p",[t._v("观战："+t._s(t.roomInfo.watchMemberIds.length))])]),o("div",{staticClass:"player-box fr"},[o("div",{staticClass:"info-box fl"},[o("p",{staticClass:"username text-right",domProps:{textContent:t._s(t.playerOther.username)}}),o("p",{staticClass:"ready-status text-right"},[t.playerOther.playerId?[2==t.roomInfo.status?o("span",[t._v("对方颜色："+t._s(t.playerOther.colorText))]):t.playerOther.ready?o("span",[t._v("已准备")]):o("span",[t._v("未准备")])]:o("span",[t._v("等待加入")])],2)]),o("img",{staticClass:"player-thumb fr",staticStyle:{"margin-left":"12px"},attrs:{src:s("70e7")}})])]),o("div",{staticClass:"gobang-area"},[o("gobang",{ref:"gobang",attrs:{disable:t.gobang.disable,lastGoX:t.gameInfo.lastGoX,lastGoY:t.gameInfo.lastGoY},on:{go:t.onGo}}),1==t.roomInfo.status?o("img",{staticClass:"img-wait",attrs:{src:s("d398")}}):t._e()],1),o("div",{staticClass:"bottom-box"},[o("div",{staticClass:"player-box fl"},[o("div",{staticClass:"info-box fr"},[o("p",{staticClass:"username",domProps:{textContent:t._s(t.playerMine.username)}}),o("p",{staticClass:"ready-status"},[t.playerMine.playerId?[2==t.roomInfo.status?o("span",[t._v("你的颜色："+t._s(t.playerMine.colorText))]):t.playerMine.ready?o("span",[t._v("已准备")]):o("span",[t._v("未准备")])]:o("span",[t._v("等待加入")])],2)]),o("img",{staticClass:"player-thumb fl",staticStyle:{"margin-right":"12px","margin-top":"14px"},attrs:{src:s("70e7")}})]),o("div",{staticClass:"btn-box"},[1!=t.roomInfo.status||t.watchMode?t._e():[t.isReady?o("button",{staticClass:"btn-cancel-ready",on:{click:t.cancelReady}},[t._v("取消准备")]):o("button",{staticClass:"btn-ready",on:{click:t.ready}},[t._v("准备")])],o("button",{staticClass:"btn-leave",on:{click:t.leave}})],2)])]:t._e(),t.roomInfo?o("chat",{staticClass:"chat-box",attrs:{room:t.roomInfo.roomId,rows:3}}):t._e(),t.showGameResultLayer?o("div",[o("div",{staticClass:"layer-mask",on:{click:t.closeGameResultLayer}}),o("div",{attrs:{id:"create-room-layer"}},[o("div",{staticClass:"title"},[t.youWin?o("img",{attrs:{src:s("e775")}}):o("img",{attrs:{src:s("1f34")}})]),o("div",{staticClass:"win-box"},[o("div",{staticClass:"left"},[o("img",{staticClass:"player-thumb",attrs:{src:s("70e7")}}),o("p",{staticClass:"username",domProps:{textContent:t._s(t.playerMine.username)}}),t.youWin?o("img",{staticClass:"right-top",attrs:{src:s("a1cc")}}):o("img",{staticClass:"right-top",attrs:{src:s("cbc4")}})]),o("div",{staticClass:"right"},[o("img",{staticClass:"player-thumb",attrs:{src:s("70e7")}}),o("p",{staticClass:"username",domProps:{textContent:t._s(t.gameResultOtherUsername)}}),t.youWin?o("img",{staticClass:"right-top",attrs:{src:s("cbc4")}}):o("img",{staticClass:"right-top",attrs:{src:s("a1cc")}})])])])]):t._e()],2)},a=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"gobang"},[s("canvas",{ref:"canvas",staticClass:"gobang-canvas",on:{click:t.canvasClick}})])},i=[],r={BLACK_PIECE:1,WHITE_PIECE:2},l={name:"Gobang",props:{size:{type:Number,default:15},lineColor:{type:String,default:"#AC9D6A"},disable:{type:Boolean,default:!1},lastGoX:{type:Number},lastGoY:{type:Number}},data(){return{canvasPadding:16,canvasObj:null,cellWidth:0,cellHeight:0,xBegin:0,yBegin:0,gobangMap:[],currentPiece:r.BLACK_PIECE}},mounted(){this.initMap(),this.paint()},methods:{initMap(){this.gobangMap=[];for(let t=0;t<this.size;++t){let t=[];for(let e=0;e<this.size;++e)t.push(0);this.gobangMap.push(t)}},paint(){Promise.all([this.loadImage(s("211b")),this.loadImage(s("fdaa"))]).then(t=>{this.canvasObj=this.$refs.canvas;const e=this.canvasObj.getBoundingClientRect();this.canvasObj.width=e.width,this.canvasObj.height=e.height;const s=this.canvasObj.getContext("2d");this.drawBgColor(s),this.drawLines(s),this.drawPieces(s,t[0],t[1])})},drawBgColor(t){const e=this.canvasObj.getBoundingClientRect();t.fillStyle="#C0AF75",t.fillRect(0,0,e.width,e.height)},drawLines(t){const e=this.canvasObj.getBoundingClientRect();this.cellWidth=(e.width-2*this.canvasPadding)/(this.size-1),this.cellHeight=(e.height-2*this.canvasPadding)/(this.size-1),this.xBegin=parseInt(this.canvasPadding)+.5;const s=parseInt(e.width-this.canvasPadding)+.5;this.yBegin=parseInt(this.canvasPadding)+.5;const o=parseInt(e.height-this.canvasPadding)+.5;t.fillStyle="#F4EAC8",t.fillRect(this.xBegin,this.yBegin,s-this.canvasPadding,o-this.canvasPadding);for(let a=0;a<this.size;++a)for(let e=0;e<this.size;++e){const o=parseInt(this.canvasPadding+e*this.cellHeight);t.beginPath(),t.moveTo(this.xBegin,o),t.lineTo(s,o),t.strokeStyle=this.lineColor,t.lineWidth=2,t.stroke()}for(let a=0;a<this.size;++a)for(let e=0;e<this.size;++e){const s=parseInt(this.canvasPadding+e*this.cellWidth);t.beginPath(),t.moveTo(s,this.yBegin),t.lineTo(s,o),t.strokeStyle=this.lineColor,t.lineWidth=2,t.stroke()}},drawPieces(t,e,s){for(let n=0;n<this.size;++n)for(let i=0;i<this.size;++i){switch(this.gobangMap[n][i]){case 1:var o=e;break;case 2:o=s;break;default:continue}var a=this.getPointXY(n,i);const r=24;this.lastGoX==n&&this.lastGoY==i&&(t.beginPath(),t.fillStyle="#70c769",t.arc(a.x-1,a.y-1,r/2+2,0,2*Math.PI),t.fill()),t.drawImage(o,a.x-r/2,a.y-r/2,r,r)}},getPointXY(t,e){return{x:this.xBegin+t*this.cellWidth,y:this.yBegin+e*this.cellHeight}},canvasClick(t){if(this.disable)return;let e=Math.round((t.offsetX-this.canvasPadding)/this.cellWidth),s=Math.round((t.offsetY-this.canvasPadding)/this.cellHeight);0==this.gobangMap[e][s]&&(this.gobangMap[e][s]=this.currentPiece,this.$emit("go",{x:e,y:s}),this.paint())},loadImage(t){return new Promise(e=>{const s=new Image;s.onload=()=>e(s),s.src=t})},setMap(t){this.gobangMap=t,this.paint()},setCurrentPiece(t){this.currentPiece=t}}},c=l,h=(s("c2ac"),s("2877")),d=Object(h["a"])(c,n,i,!1,null,"445d2c36",null),p=d.exports,m=s("e6b0"),g={components:{Gobang:p,Chat:m["a"]},data(){return{gobang:{disable:!0},roomInfo:null,gameInfo:{lastGoX:null,lastGoY:null},isReady:!1,watchMode:!1,playerOther:{playerId:null,username:"-",ready:!1,color:null,colorText:""},playerMine:{playerId:null,username:"-",ready:!1,color:null,colorText:""},win:!1,showGameResultLayer:!1,youWin:!1,gameResultOtherUsername:""}},mounted(){const t=this.$route.params;t.roomInfo?(this.watchMode=!!t.watchMode,this.roomInfo=t.roomInfo,this.GLOBAL.websocketConnection.onAction("room.info",this.onJoinInfo),this.GLOBAL.websocketConnection.onAction("room.ready",this.onRoomReady),this.GLOBAL.websocketConnection.onAction("room.cancelReady",this.onRoomCancelReady),this.GLOBAL.websocketConnection.onAction("room.destory",this.onRoomDestory),this.GLOBAL.websocketConnection.onAction("room.leave",this.onLeave),this.GLOBAL.websocketConnection.onAction("gobang.info",this.onGobangInfo),this.GLOBAL.websocketConnection.sendEx("room.info",{roomId:this.roomInfo.roomId}),this.GLOBAL.websocketConnection.onClose(t=>{alert("断线了"),location.reload()})):this.$router.replace("/")},methods:{onJoinInfo(t){this.roomInfo=t.roomInfo,this.updatePlayer(),this.updateGobangDisable()},ready(){this.GLOBAL.websocketConnection.sendEx("room.ready",{roomId:this.roomInfo.roomId})},leave(){this.GLOBAL.websocketConnection.sendEx("room.leave",{roomId:this.roomInfo.roomId})},onRoomReady(t){this.isReady=!0},cancelReady(){this.GLOBAL.websocketConnection.sendEx("room.cancelReady",{roomId:this.roomInfo.roomId})},onRoomCancelReady(t){this.isReady=!1},onRoomDestory(t){alert("房间被销毁"),this.$router.replace("/rooms")},onGobangInfo(t){if(t.game){const e=t.game;this.gameInfo=e,this.$nextTick(()=>{this.$refs.gobang&&this.$refs.gobang.setMap(e.gobangMap)}),this.updatePlayer(),this.updateGobangDisable()}t.winner&&(this.gameResultOtherUsername=this.playerOther.username,this.youWin=t.winner.id===this.playerMine.playerId,this.openGameResultLayer(),this.isReady=!1)},onLeave(t){this.$router.replace("/rooms")},updatePlayer(){if(this.roomInfo){switch(this.GLOBAL.userInfo.id===this.roomInfo.playerId1?(this.playerMine.playerId=this.roomInfo.playerId1,this.playerOther.playerId=this.roomInfo.playerId2,this.playerMine.username=this.roomInfo.player1.username,this.roomInfo.player2?this.playerOther.username=this.roomInfo.player2.username:this.playerOther.username="",this.playerMine.ready=this.roomInfo.player1Ready,this.playerOther.ready=this.roomInfo.player2Ready,this.gameInfo&&(this.playerMine.color=this.gameInfo.player1Color,this.playerOther.color=this.gameInfo.player2Color)):(this.playerMine.playerId=this.roomInfo.playerId2,this.playerOther.playerId=this.roomInfo.playerId1,this.roomInfo.player2&&(this.playerMine.username=this.roomInfo.player2.username),this.roomInfo.player1?this.playerOther.username=this.roomInfo.player1.username:this.playerOther.username="",this.playerMine.ready=this.roomInfo.player2Ready,this.playerOther.ready=this.roomInfo.player1Ready,this.gameInfo&&(this.playerMine.color=this.gameInfo.player2Color,this.playerOther.color=this.gameInfo.player1Color)),this.playerMine.color){case r.BLACK_PIECE:this.playerMine.colorText="黑";break;case r.WHITE_PIECE:this.playerMine.colorText="白";break;default:this.playerMine.colorText="";break}switch(this.playerOther.color){case r.BLACK_PIECE:this.playerOther.colorText="黑";break;case r.WHITE_PIECE:this.playerOther.colorText="白";break;default:this.playerOther.colorText="";break}this.$nextTick(()=>{this.$refs.gobang&&this.$refs.gobang.setCurrentPiece(this.playerMine.color)})}},updateGobangDisable(){this.gameInfo&&(this.gobang.disable=1===this.roomInfo.status||!(this.gameInfo.currentPiece===this.playerMine.color))},onGo(t){this.gobang.disable=!0,this.GLOBAL.websocketConnection.sendEx("gobang.go",{roomId:this.roomInfo.roomId,x:t.x,y:t.y})},openGameResultLayer(t){this.win=t,this.showGameResultLayer=!0},closeGameResultLayer(){this.showGameResultLayer=!1}}},u=g,y=(s("d83f"),Object(h["a"])(u,o,a,!1,null,"73efe67e",null));e["default"]=y.exports},"9daf":function(t,e,s){},a1cc:function(t,e,s){t.exports=s.p+"img/win.d00705e3.png"},ab36:function(t,e,s){},c2ac:function(t,e,s){"use strict";var o=s("9daf"),a=s.n(o);a.a},cbc4:function(t,e,s){t.exports=s.p+"img/lose.637c776d.png"},d398:function(t,e,s){t.exports=s.p+"img/wait.3de71593.png"},d83f:function(t,e,s){"use strict";var o=s("ab36"),a=s.n(o);a.a},e322:function(t,e,s){},e6b0:function(t,e,s){"use strict";var o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"chat"},[s("ul",{ref:"chatContent",staticClass:"chat-content",style:t.chatContentStyle},t._l(t.chatRecords,(function(e,o){return s("li",[1==e.type?s("span",{staticClass:"sender sender-system"},[s("span",{domProps:{textContent:t._s(e.sender)}}),t._v(": ")]):t._e(),2==e.type?s("span",{staticClass:"sender sender-chat"},[s("span",{domProps:{textContent:t._s(e.sender)}}),t._v(": ")]):t._e(),s("span",{domProps:{textContent:t._s(e.content)}})])})),0),s("form",{staticClass:"input-area",on:{submit:function(e){return e.preventDefault(),t.sendContent(e)}}},[s("div",{staticClass:"send-input-box"},[s("input",{directives:[{name:"model",rawName:"v-model",value:t.inputContent,expression:"inputContent"}],attrs:{type:"text"},domProps:{value:t.inputContent},on:{input:function(e){e.target.composing||(t.inputContent=e.target.value)}}}),s("button",{staticClass:"btn-send"})])])])},a=[],n=s("5a6c"),i={name:"Chat",props:{room:{},rows:{type:Number,default:10}},data(){return{wsConn:null,inputContent:"",chatRecords:[],chatContentStyle:"",timer:null}},mounted(){this.wsConn=new n["a"],this.wsConn.onAction("im.receive",this.onReceive),this.wsConn.onClose(t=>{this.chatRecords.push({action:"im.receive",sender:"系统消息",type:1,content:"断线重连..."}),this.timer}),this.openConn(),this.chatContentStyle="height:"+(24*this.rows+20)+"px"},beforeDestroy(){this.timer&&clearTimeout(this.timer),this.timer=!1,this.wsConn.close()},methods:{openConn(){this.wsConn.open("ws://127.0.0.1:8080/im",()=>{this.wsConn.sendEx("im.joinRoom",{roomId:this.room})})},sendContent(){""!==this.inputContent&&(this.wsConn.sendEx("im.send",{content:this.inputContent,roomId:this.room}),this.inputContent="")},onReceive(t,e=!0){const s=this.$refs.chatContent;if(!s){if(!e)return;return void this.$nextTick(()=>{this.onReceive(t,!1)})}const o=s.scrollHeight-s.scrollTop===s.clientHeight;this.chatRecords.length>=100&&this.chatRecords.shift(),this.chatRecords.push(t),o&&this.$nextTick((function(){s.scrollTop=s.scrollHeight}))}}},r=i,l=(s("3ea5"),s("2877")),c=Object(l["a"])(r,o,a,!1,null,"49bf4fd0",null);e["a"]=c.exports},e775:function(t,e,s){t.exports=s.p+"img/victory.79b8c81f.png"},fdaa:function(t,e,s){t.exports=s.p+"img/white.0a2c0e7b.png"}}]);
//# sourceMappingURL=gobang.4c5b1b08.js.map