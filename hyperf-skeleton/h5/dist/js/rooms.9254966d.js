(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["rooms"],{"3ea5":function(t,o,e){"use strict";var n=e("e322"),s=e.n(n);s.a},a65d:function(t,o,e){},b924:function(t,o,e){"use strict";e.r(o);var n=function(){var t=this,o=t.$createElement,n=t._self._c||o;return n("div",{staticClass:"rooms"},[t.GLOBAL.userInfo?n("p",{staticClass:"hello"},[n("img",{staticClass:"logined-thumb",attrs:{src:e("70e7")}}),t._v("\n    你好，"+t._s(t.GLOBAL.userInfo.username)+"！\n  ")]):t._e(),n("div",[n("h1",[t._v("房间列表")]),n("button",{attrs:{id:"btn-create-room"},on:{click:t.openCreateRoom}})]),n("ul",{staticClass:"room-list"},t._l(t.rooms,(function(o,e){return n("li",{key:e},[n("div",[n("span",{staticClass:"title"},[t._v("["+t._s(o.statusText)+"]"+t._s(o.title))])]),n("div",{staticClass:"username"},[t._v("房主："+t._s(o.creator.username))]),n("div",{staticClass:"box1"},[n("span",{staticClass:"person"},[t._v("人数：("+t._s(o.person)+"/2)")]),n("div",{staticClass:"room-btn-box"},[o.person<2?n("a",{staticClass:"join",on:{click:function(e){return t.join(o)}}},[t._v("加入")]):t._e(),n("a",{staticClass:"watch",on:{click:function(e){return t.watch(o)}}},[t._v("观战")])])])])})),0),n("chat",{staticClass:"chat-box",staticStyle:{"margin-top":"16px"},attrs:{room:"rooms",rows:5}}),t.showCreateRoomLayer?n("div",[n("div",{staticClass:"layer-mask",on:{click:t.closeCreateRoom}}),n("div",{attrs:{id:"create-room-layer"}},[n("p",{staticClass:"layer-title"},[t._v("创建房间")]),n("a",{staticClass:"btn-close-create-room",on:{click:t.closeCreateRoom}}),n("div",[n("input",{directives:[{name:"model",rawName:"v-model",value:t.roomName,expression:"roomName"}],staticClass:"input",attrs:{id:"input-room-name",type:"text",placeholder:"请输入房间名称"},domProps:{value:t.roomName},on:{input:function(o){o.target.composing||(t.roomName=o.target.value)}}})]),n("div",[n("a",{staticClass:"big-btn",attrs:{id:"btn-submit-create-room"},on:{click:t.createRoom}},[t._v("创建")])])])]):t._e()],1)},s=[],i=e("e6b0"),a=(e("2919"),{components:{Chat:i["a"]},data(){return{rooms:[],showCreateRoomLayer:!1,roomName:""}},mounted(){if(!this.GLOBAL.userInfo)return alert("未登陆"),void this.$router.replace("/");try{this.GLOBAL.websocketConnection.open("ws://127.0.0.1:9502/ws",()=>{this.loadRoomList()})}catch(t){alert(t)}this.GLOBAL.websocketConnection.onAction("room.list",this.onRoomList),this.GLOBAL.websocketConnection.onAction("room.create",this.onCreateRoom),this.GLOBAL.websocketConnection.onAction("room.join",this.onJoinRoom),this.GLOBAL.websocketConnection.onAction("room.watch",this.onWatchRoom),this.GLOBAL.websocketConnection.onClose(t=>{})},methods:{loadRoomList(){this.GLOBAL.websocketConnection.sendEx("room.list")},openCreateRoom(){this.showCreateRoomLayer=!0},closeCreateRoom(){this.showCreateRoomLayer=!1},createRoom(){this.GLOBAL.websocketConnection.sendEx("room.create",{title:this.roomName})},join(t){this.GLOBAL.websocketConnection.sendEx("room.join",{roomId:t.roomId})},watch(t){this.GLOBAL.websocketConnection.sendEx("room.watch",{roomId:t.roomId})},onRoomList(t){this.rooms=t.list},onCreateRoom(t){this.$router.replace({name:"gobang",params:{roomInfo:t.roomInfo}})},onJoinRoom(t){this.$router.replace({name:"gobang",params:{roomInfo:t.roomInfo}})},onWatchRoom(t){this.$router.replace({name:"gobang",params:{roomInfo:t.roomInfo,watchMode:!0}})}}}),r=a,c=(e("e94e"),e("2877")),m=Object(c["a"])(r,n,s,!1,null,"469361aa",null);o["default"]=m.exports},e322:function(t,o,e){},e6b0:function(t,o,e){"use strict";var n=function(){var t=this,o=t.$createElement,e=t._self._c||o;return e("div",{staticClass:"chat"},[e("ul",{ref:"chatContent",staticClass:"chat-content",style:t.chatContentStyle},t._l(t.chatRecords,(function(o,n){return e("li",[1==o.type?e("span",{staticClass:"sender sender-system"},[e("span",{domProps:{textContent:t._s(o.sender)}}),t._v(": ")]):t._e(),2==o.type?e("span",{staticClass:"sender sender-chat"},[e("span",{domProps:{textContent:t._s(o.sender)}}),t._v(": ")]):t._e(),e("span",{domProps:{textContent:t._s(o.content)}})])})),0),e("form",{staticClass:"input-area",on:{submit:function(o){return o.preventDefault(),t.sendContent(o)}}},[e("div",{staticClass:"send-input-box"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.inputContent,expression:"inputContent"}],attrs:{type:"text"},domProps:{value:t.inputContent},on:{input:function(o){o.target.composing||(t.inputContent=o.target.value)}}}),e("button",{staticClass:"btn-send"})])])])},s=[],i=e("5a6c"),a={name:"Chat",props:{room:{},rows:{type:Number,default:10}},data(){return{wsConn:null,inputContent:"",chatRecords:[],chatContentStyle:"",timer:null}},mounted(){this.wsConn=new i["a"],this.wsConn.onAction("im.receive",this.onReceive),this.wsConn.onClose(t=>{this.chatRecords.push({action:"im.receive",sender:"系统消息",type:1,content:"断线重连..."}),this.timer}),this.openConn(),this.chatContentStyle="height:"+(24*this.rows+20)+"px"},beforeDestroy(){this.timer&&clearTimeout(this.timer),this.timer=!1,this.wsConn.close()},methods:{openConn(){this.wsConn.open("ws://127.0.0.1:8080/im",()=>{this.wsConn.sendEx("im.joinRoom",{roomId:this.room})})},sendContent(){""!==this.inputContent&&(this.wsConn.sendEx("im.send",{content:this.inputContent,roomId:this.room}),this.inputContent="")},onReceive(t,o=!0){const e=this.$refs.chatContent;if(!e){if(!o)return;return void this.$nextTick(()=>{this.onReceive(t,!1)})}const n=e.scrollHeight-e.scrollTop===e.clientHeight;this.chatRecords.length>=100&&this.chatRecords.shift(),this.chatRecords.push(t),n&&this.$nextTick((function(){e.scrollTop=e.scrollHeight}))}}},r=a,c=(e("3ea5"),e("2877")),m=Object(c["a"])(r,n,s,!1,null,"49bf4fd0",null);o["a"]=m.exports},e94e:function(t,o,e){"use strict";var n=e("a65d"),s=e.n(n);s.a}}]);
//# sourceMappingURL=rooms.9254966d.js.map