{"version":3,"sources":["webpack:///./src/components/Chat.vue?9918","webpack:///./src/views/Rooms.vue?e0d5","webpack:///src/views/Rooms.vue","webpack:///./src/views/Rooms.vue?3dab","webpack:///./src/views/Rooms.vue","webpack:///./src/components/Chat.vue?e768","webpack:///src/components/Chat.vue","webpack:///./src/components/Chat.vue?ca2a","webpack:///./src/components/Chat.vue","webpack:///./src/views/Rooms.vue?9e0f"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","GLOBAL","attrs","_v","_s","userInfo","username","_e","on","openCreateRoom","_l","item","index","key","statusText","title","creator","person","$event","join","watch","staticStyle","closeCreateRoom","directives","name","rawName","value","expression","domProps","target","composing","roomName","createRoom","staticRenderFns","components","Chat","rooms","showCreateRoomLayer","alert","$router","replace","websocketConnection","open","loadRoomList","e","onAction","onRoomList","onCreateRoom","onJoinRoom","onWatchRoom","onClose","evt","methods","sendEx","room","roomId","data","list","params","roomInfo","watchMode","component","ref","style","type","sender","content","preventDefault","sendContent","inputContent","props","rows","Number","default","wsConn","chatRecords","chatContentStyle","timer","onReceive","push","action","openConn","clearTimeout","close","allowRetry","chatContent","$refs","$nextTick","willScroll","scrollHeight","scrollTop","clientHeight","length","shift"],"mappings":"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","file":"js/rooms.9254966d.js","sourcesContent":["import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=style&index=0&id=49bf4fd0&lang=less&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=style&index=0&id=49bf4fd0&lang=less&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"rooms\"},[(_vm.GLOBAL.userInfo)?_c('p',{staticClass:\"hello\"},[_c('img',{staticClass:\"logined-thumb\",attrs:{\"src\":require(\"../assets/thumb.png\")}}),_vm._v(\"\\n    你好，\"+_vm._s(_vm.GLOBAL.userInfo.username)+\"！\\n  \")]):_vm._e(),_c('div',[_c('h1',[_vm._v(\"房间列表\")]),_c('button',{attrs:{\"id\":\"btn-create-room\"},on:{\"click\":_vm.openCreateRoom}})]),_c('ul',{staticClass:\"room-list\"},_vm._l((_vm.rooms),function(item,index){return _c('li',{key:index},[_c('div',[_c('span',{staticClass:\"title\"},[_vm._v(\"[\"+_vm._s(item.statusText)+\"]\"+_vm._s(item.title))])]),_c('div',{staticClass:\"username\"},[_vm._v(\"房主：\"+_vm._s(item.creator.username))]),_c('div',{staticClass:\"box1\"},[_c('span',{staticClass:\"person\"},[_vm._v(\"人数：(\"+_vm._s(item.person)+\"/2)\")]),_c('div',{staticClass:\"room-btn-box\"},[(item.person < 2)?_c('a',{staticClass:\"join\",on:{\"click\":function($event){return _vm.join(item)}}},[_vm._v(\"加入\")]):_vm._e(),_c('a',{staticClass:\"watch\",on:{\"click\":function($event){return _vm.watch(item)}}},[_vm._v(\"观战\")])])])])}),0),_c('chat',{staticClass:\"chat-box\",staticStyle:{\"margin-top\":\"16px\"},attrs:{\"room\":\"rooms\",\"rows\":5}}),(_vm.showCreateRoomLayer)?_c('div',[_c('div',{staticClass:\"layer-mask\",on:{\"click\":_vm.closeCreateRoom}}),_c('div',{attrs:{\"id\":\"create-room-layer\"}},[_c('p',{staticClass:\"layer-title\"},[_vm._v(\"创建房间\")]),_c('a',{staticClass:\"btn-close-create-room\",on:{\"click\":_vm.closeCreateRoom}}),_c('div',[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.roomName),expression:\"roomName\"}],staticClass:\"input\",attrs:{\"id\":\"input-room-name\",\"type\":\"text\",\"placeholder\":\"请输入房间名称\"},domProps:{\"value\":(_vm.roomName)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.roomName=$event.target.value}}})]),_c('div',[_c('a',{staticClass:\"big-btn\",attrs:{\"id\":\"btn-submit-create-room\"},on:{\"click\":_vm.createRoom}},[_vm._v(\"创建\")])])])]):_vm._e()],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"rooms\">\r\n    <p class=\"hello\" v-if=\"GLOBAL.userInfo\">\r\n      <img class=\"logined-thumb\" src=\"../assets/thumb.png\"/>\r\n      你好，{{GLOBAL.userInfo.username}}！\r\n    </p>\r\n\r\n    <div>\r\n      <h1>房间列表</h1>\r\n      <button id=\"btn-create-room\" @click=\"openCreateRoom\"></button>\r\n    </div>\r\n\r\n    <!-- 房间列表 -->\r\n    <ul class=\"room-list\">\r\n      <li v-for=\"(item, index) in rooms\" :key=\"index\">\r\n        <div>\r\n          <span class=\"title\">[{{item.statusText}}]{{item.title}}</span>\r\n        </div>\r\n\r\n        <div class=\"username\">房主：{{item.creator.username}}</div>\r\n\r\n        <div class=\"box1\">\r\n          <span class=\"person\">人数：({{item.person}}/2)</span>\r\n          <div class=\"room-btn-box\">\r\n            <a class=\"join\" v-if=\"item.person < 2\" @click=\"join(item)\">加入</a>\r\n            <a class=\"watch\" @click=\"watch(item)\">观战</a>\r\n          </div>\r\n        </div>\r\n      </li>\r\n    </ul>\r\n\r\n    <!-- 聊天 -->\r\n    <chat room=\"rooms\" class=\"chat-box\" :rows=\"5\" style=\"margin-top:16px\"></chat>\r\n\r\n    <!-- 创建房间层 -->\r\n    <div v-if=\"showCreateRoomLayer\">\r\n      <div class=\"layer-mask\" @click=\"closeCreateRoom\"></div>\r\n      <div id=\"create-room-layer\">\r\n        <p class=\"layer-title\">创建房间</p>\r\n        <a class=\"btn-close-create-room\" @click=\"closeCreateRoom\"></a>\r\n        <div><input id=\"input-room-name\" class=\"input\" type=\"text\" placeholder=\"请输入房间名称\" v-model=\"roomName\"/></div>\r\n        <div>\r\n          <a class=\"big-btn\" id=\"btn-submit-create-room\" @click=\"createRoom\">创建</a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport Chat from \"@/components/Chat.vue\";\r\nimport global from '../global';\r\nexport default {\r\n  components: {\r\n    Chat,\r\n  },\r\n  data() {\r\n    return {\r\n      rooms: [\r\n        // 测试数据：\r\n        // {\r\n        //   \"title\": \"快来人！！！快来人！！！快来人！！！快来人！！！\", // 标题\r\n        //   \"creator\": \"测试昵称\", // 创建者\r\n        //   \"person\": 1, // 人数\r\n        //   \"status\": 1, // 状态\r\n        //   \"statusText\": \"等待中\", // 状态文本\r\n        // },\r\n        // {\r\n        //   \"title\": \"快来人！！！\",\r\n        //   \"creator\": \"测试昵称\",\r\n        //   \"person\": 2,\r\n        //   \"status\": 2,\r\n        //   \"statusText\": \"对弈中\",\r\n        // }\r\n      ],\r\n      showCreateRoomLayer: false,\r\n      roomName: '',\r\n    };\r\n  },\r\n  mounted(){\r\n    if(!this.GLOBAL.userInfo)\r\n    {\r\n      alert(\"未登陆\");\r\n      this.$router.replace(\"/\");\r\n      return;\r\n    }\r\n    try {\r\n      this.GLOBAL.websocketConnection.open(process.env.VUE_APP_GAME_WEBSOCKET_URL, ()=>{\r\n        this.loadRoomList();\r\n      });\r\n    } catch(e) {\r\n      alert(e)\r\n    }\r\n    this.GLOBAL.websocketConnection.onAction('room.list', this.onRoomList)\r\n    this.GLOBAL.websocketConnection.onAction('room.create', this.onCreateRoom)\r\n    this.GLOBAL.websocketConnection.onAction('room.join', this.onJoinRoom)\r\n    this.GLOBAL.websocketConnection.onAction('room.watch', this.onWatchRoom)\r\n    this.GLOBAL.websocketConnection.onClose((evt)=>{\r\n    //  alert('断线了')\r\n     // location.reload()\r\n    })\r\n  },\r\n  methods: {\r\n    // 加载房间列表\r\n    loadRoomList(){\r\n      this.GLOBAL.websocketConnection.sendEx('room.list');\r\n    },\r\n    // 打开创建房间窗口\r\n    openCreateRoom(){\r\n      this.showCreateRoomLayer = true;\r\n    },\r\n    // 关闭创建房间窗口\r\n    closeCreateRoom(){\r\n      this.showCreateRoomLayer = false;\r\n    },\r\n    // 创建房间\r\n    createRoom(){\r\n      this.GLOBAL.websocketConnection.sendEx('room.create', {\r\n        title: this.roomName,\r\n      });\r\n    },\r\n    // 加入\r\n    join(room){\r\n      this.GLOBAL.websocketConnection.sendEx('room.join', {\r\n        roomId: room.roomId,\r\n      });\r\n    },\r\n    // 观战\r\n    watch(room){\r\n      this.GLOBAL.websocketConnection.sendEx('room.watch', {\r\n        roomId: room.roomId,\r\n      });\r\n    },\r\n    // 房间列表回调\r\n    onRoomList(data){\r\n      this.rooms = data.list;\r\n    },\r\n    // 创建房间回调\r\n    onCreateRoom(data){\r\n      this.$router.replace({\r\n        name: 'gobang',\r\n        params: {\r\n          roomInfo: data.roomInfo,\r\n        },\r\n      });\r\n    },\r\n    // 加入房间回调\r\n    onJoinRoom(data){\r\n      this.$router.replace({\r\n        name: 'gobang',\r\n        params: {\r\n          roomInfo: data.roomInfo,\r\n        },\r\n      });\r\n    },\r\n    // 观战回调\r\n    onWatchRoom(data){\r\n      this.$router.replace({\r\n        name: 'gobang',\r\n        params: {\r\n          roomInfo: data.roomInfo,\r\n          watchMode: true,\r\n        },\r\n      });\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\nh1{\r\n  display: inline;\r\n  line-height: 40px;\r\n  font-size: 22px;\r\n}\r\n.rooms {\r\n  height: 100vh;\r\n  display: flex;\r\n  align-content: flex-start;\r\n  flex-direction:column;\r\n  .hello{\r\n    color: #fff;\r\n    font-size: 20px;\r\n  }\r\n  .logined-thumb{\r\n    width: 36px;\r\n    height: 36px;\r\n    vertical-align: middle;\r\n    padding-right: 8px;\r\n    padding-bottom: 6px;\r\n  }\r\n  .chat-box{\r\n    margin-bottom: 8px;\r\n  }\r\n  #btn-create-room {\r\n    display: inline-block;\r\n    background-color:linear-gradient(-18deg,rgba(233,236,243,1) 0%,rgba(255,255,255,1) 100%);\r\n    border:none;\r\n    border-radius:30px;\r\n    width: 100px;\r\n    line-height: 40px;\r\n    height: 40px;\r\n    float: right;\r\n    &::after{\r\n      content: ' ';\r\n      display: block;\r\n      background-image: url(../assets/create-room.png);\r\n      background-size: 90%;\r\n      background-position: center;\r\n      background-repeat: no-repeat;\r\n      width: 100%;\r\n      height: inherit;\r\n    }\r\n  }\r\n  .room-list{\r\n    flex: auto;\r\n    font-size: 18px;\r\n    overflow: auto;\r\n    padding: 0;\r\n    margin-bottom: 0;\r\n    li{\r\n      background:rgba(243,244,248,0.5);\r\n      border:1px solid rgba(255,255,255,1);\r\n      border-radius:20px;\r\n      padding: 16px 18px;\r\n      position: relative;\r\n      margin-bottom: 12px;\r\n      .title{\r\n        display:inline-block;\r\n        overflow: hidden;\r\n        white-space: nowrap;\r\n        text-overflow: ellipsis;\r\n        vertical-align: middle;\r\n        width: -webkit-fill-available;\r\n        color: #0D3129;\r\n        font-size: 24px;\r\n        font-weight:bold;\r\n      }\r\n      .username{\r\n        margin-top: 20px;\r\n        color: #323F49;\r\n      }\r\n      .box1{\r\n        margin-top: 20px;\r\n        color: #323F49;\r\n      }\r\n      .person{\r\n        margin-right: 1em;\r\n      }\r\n      .join,.watch{\r\n        background:rgba(243,244,248,1);\r\n        border-radius:30px;\r\n        width: 92px;\r\n        line-height: 36px;\r\n        text-align: center;\r\n      }\r\n      .join{\r\n        display: inline-block;\r\n        text-decoration: none;\r\n        color: #43BB43;\r\n        margin-right: 4px;\r\n      }\r\n      .watch{\r\n        display: inline-block;\r\n        text-decoration: none;\r\n        color: #1E9FFF;\r\n      }\r\n      .room-btn-box{\r\n        float:right;\r\n        margin-top: -10px;\r\n      }\r\n    }\r\n  }\r\n}\r\n#create-room-layer{\r\n  background-color: #fff;\r\n  border-radius:30px;\r\n  width: 500px;\r\n  height: 260px;\r\n  max-width: 100%;\r\n  position:absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  transform: translate(-50%, -50%);\r\n  padding: 0 40px 0 40px;\r\n  box-sizing: border-box;\r\n  .layer-title{\r\n    color:#323F49;\r\n    font-size: 22px;\r\n    text-align: center;\r\n    margin-bottom: 0;\r\n  }\r\n  .btn-close-create-room{\r\n    display: block;\r\n    width: 16px;\r\n    height: 16px;\r\n    background-image: url(../assets/close.png);\r\n    background-size: cover;\r\n    position: absolute;\r\n    right: 20px;\r\n    top: 20px;\r\n  }\r\n  #input-room-name{\r\n    margin-top: 28px;\r\n  }\r\n  #btn-submit-create-room{\r\n    margin-top: 10px;\r\n  }\r\n}\r\n</style>","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Rooms.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Rooms.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Rooms.vue?vue&type=template&id=469361aa&scoped=true&\"\nimport script from \"./Rooms.vue?vue&type=script&lang=js&\"\nexport * from \"./Rooms.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Rooms.vue?vue&type=style&index=0&id=469361aa&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"469361aa\",\n  null\n  \n)\n\nexport default component.exports","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"chat\"},[_c('ul',{ref:\"chatContent\",staticClass:\"chat-content\",style:(_vm.chatContentStyle)},_vm._l((_vm.chatRecords),function(item,index){return _c('li',[(1 == item.type)?_c('span',{staticClass:\"sender sender-system\"},[_c('span',{domProps:{\"textContent\":_vm._s(item.sender)}}),_vm._v(\": \")]):_vm._e(),(2 == item.type)?_c('span',{staticClass:\"sender sender-chat\"},[_c('span',{domProps:{\"textContent\":_vm._s(item.sender)}}),_vm._v(\": \")]):_vm._e(),_c('span',{domProps:{\"textContent\":_vm._s(item.content)}})])}),0),_c('form',{staticClass:\"input-area\",on:{\"submit\":function($event){$event.preventDefault();return _vm.sendContent($event)}}},[_c('div',{staticClass:\"send-input-box\"},[_c('input',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.inputContent),expression:\"inputContent\"}],attrs:{\"type\":\"text\"},domProps:{\"value\":(_vm.inputContent)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.inputContent=$event.target.value}}}),_c('button',{staticClass:\"btn-send\"})])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"chat\">\r\n    <!-- <textarea class=\"chat-content\" contentEditable=\"true\" readonly v-text=\"chatContent\" ></textarea> -->\r\n    <ul ref=\"chatContent\" class=\"chat-content\" :style=\"chatContentStyle\">\r\n      <li v-for=\"(item, index) in chatRecords\">\r\n        <span class=\"sender sender-system\" v-if=\"1 == item.type\"><span v-text=\"item.sender\"></span>: </span>\r\n        <span class=\"sender sender-chat\" v-if=\"2 == item.type\"><span v-text=\"item.sender\"></span>: </span>\r\n        <span v-text=\"item.content\"></span>\r\n      </li>\r\n    </ul>\r\n    <form class=\"input-area\" @submit.prevent=\"sendContent\">\r\n      <div class=\"send-input-box\">\r\n        <input type=\"text\" v-model=\"inputContent\"/>\r\n        <button class=\"btn-send\"></button>\r\n      </div>\r\n    </form>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport WS from '../utils/ws';\r\nexport default {\r\n  name: \"Chat\",\r\n  props: {\r\n    room: {\r\n    },\r\n    rows: {\r\n      type: Number,\r\n      default: 10,\r\n    },\r\n  },\r\n  data() {\r\n    return {\r\n      // WebSocket 连接对象\r\n      wsConn: null,\r\n      // 输入区内容\r\n      inputContent: '',\r\n      // 聊天记录\r\n      chatRecords: [],\r\n      // 聊天内容区样式\r\n      chatContentStyle: '',\r\n      timer: null,\r\n    };\r\n  },\r\n  mounted() {\r\n    this.wsConn = new WS\r\n    this.wsConn.onAction('im.receive', this.onReceive)\r\n    this.wsConn.onClose((evt)=>{\r\n      this.chatRecords.push({\r\n        action: 'im.receive',\r\n        sender: '系统消息',\r\n        type: 1,\r\n        content: '断线重连...',\r\n      });\r\n      if(false !== this.timer)\r\n      {\r\n        // this.timer = setTimeout(this.openConn, 3000);\r\n      }\r\n    })\r\n    this.openConn()\r\n    this.chatContentStyle = 'height:' + (24 * this.rows + 20) + 'px';\r\n  },\r\n  beforeDestroy(){\r\n    if(this.timer)\r\n    {\r\n      clearTimeout(this.timer)\r\n    }\r\n    this.timer = false;\r\n    this.wsConn.close();\r\n  },\r\n  methods: {\r\n    openConn(){\r\n      this.wsConn.open(process.env.VUE_APP_IM_WEBSOCKET_URL, ()=>{\r\n        this.wsConn.sendEx('im.joinRoom', {\r\n          roomId: this.room,\r\n        });\r\n      });\r\n    },\r\n    // 发送内容\r\n    sendContent(){\r\n      if('' === this.inputContent)\r\n      {\r\n        return;\r\n      }\r\n      this.wsConn.sendEx('im.send', {\r\n        content: this.inputContent,\r\n        roomId: this.room,\r\n      });\r\n      this.inputContent = '';\r\n    },\r\n    // 接收内容\r\n    onReceive(data, allowRetry = true){\r\n      const chatContent = this.$refs.chatContent;\r\n      if(!chatContent)\r\n      {\r\n        if(!allowRetry)\r\n        {\r\n          return;\r\n        }\r\n        this.$nextTick(()=>{\r\n          this.onReceive(data, false)\r\n        })\r\n        return;\r\n      }\r\n      const willScroll = chatContent.scrollHeight - chatContent.scrollTop === chatContent.clientHeight;\r\n      if(this.chatRecords.length >= 100)\r\n      {\r\n        this.chatRecords.shift();\r\n      }\r\n      this.chatRecords.push(data);\r\n      if(willScroll)\r\n      {\r\n        this.$nextTick(function(){\r\n          chatContent.scrollTop = chatContent.scrollHeight;\r\n        })\r\n      }\r\n    },\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.chat {\r\n  display: flex;\r\n  flex-direction:column;\r\n  .chat-content{\r\n    width: 100%;\r\n    box-sizing: border-box;\r\n    flex:auto;\r\n    border:none;\r\n    background:rgba(0,0,0,0.5);\r\n    border-radius:8px;\r\n    outline: none;\r\n    padding: 10px;\r\n    list-style: none;\r\n    color: #fff;\r\n    overflow: auto;\r\n    margin-bottom: 6px;\r\n    margin-top: 0;\r\n    li{\r\n      word-break: break-word;\r\n      line-height: 24px;\r\n      span{\r\n        &.sender{\r\n          color: #FFA81E;\r\n          &.sender-system{\r\n            color: #E74856;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  .input-area{\r\n    .send-input-box{\r\n      line-height: 48px;\r\n      display: flex;\r\n      flex-flow:row;\r\n      border-radius:10px;\r\n      background-color: #E9ECF3;\r\n      input{\r\n        flex: 1;\r\n        width: 100%;\r\n        line-height: 48px;\r\n        outline: none;\r\n        border:none;\r\n        font-size: 24px;\r\n        color: #323F49;\r\n        border-radius:12px;\r\n        background-color: #E9ECF3;\r\n        box-sizing: border-box;\r\n        padding-left: 20px;\r\n        padding-right: 0;\r\n      }\r\n      .btn-send{\r\n        width: 64px;\r\n        border:none;\r\n        outline: none;\r\n        background-image: url(../assets/send.png);\r\n        background-repeat: no-repeat;\r\n        background-position: center;\r\n        background-size: 32px;\r\n        border-radius:12px;\r\n        background-color: #E9ECF3;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Chat.vue?vue&type=template&id=49bf4fd0&scoped=true&\"\nimport script from \"./Chat.vue?vue&type=script&lang=js&\"\nexport * from \"./Chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Chat.vue?vue&type=style&index=0&id=49bf4fd0&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"49bf4fd0\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Rooms.vue?vue&type=style&index=0&id=469361aa&lang=less&scoped=true&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/index.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Rooms.vue?vue&type=style&index=0&id=469361aa&lang=less&scoped=true&\""],"sourceRoot":""}